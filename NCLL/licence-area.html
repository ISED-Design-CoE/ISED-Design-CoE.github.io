<!DOCTYPE html>
<!--[if lt IE 9]><html class="no-js lt-ie9" lang="en" dir="ltr"><![endif]-->
<!--[if gt IE 8]><!--><html class="no-js" lang="en" dir="ltr"><!--<![endif]-->
	<head>
<!-- Based on CDTS 4.1.0 (https://cenw-wscoe.github.io/sgdc-cdts/docs/index-en.html) with DECoE customizations added (look for "DECoE customization" in comments) -->
	 <meta charset="utf-8">

<!-- Start DECoE customization -->
		<title>
			Licence area - NCLL portal - Spectrum licensing services - Innovation, Science and Economic Development Canada
		</title>
<!-- End DECoE customization -->

		<meta content="width=device-width,initial-scale=1" name="viewport">
		<script src="https://www.canada.ca/etc/designs/canada/cdts/gcweb/v4_1_0/cdts/compiled/soyutils.js"></script>
		<script src="https://www.canada.ca/etc/designs/canada/cdts/gcweb/v4_1_0/cdts/compiled/wet-en.js"></script>
		<noscript>
			<!-- Write closure fall-back static file -->
			<!-- refTop.html -->
		</noscript>
		<!-- Write closure template -->
		<script>
			document.write(wet.builder.refTop({
				"cdnEnv": "esdcprod"
			}));
		</script>

<!-- Start DECoE customization -->

<link rel="stylesheet" href="libs/leaflet.css"/>
<link rel="stylesheet" href="src/leaflet.draw.css"/>

<script src="libs/leaflet-src.js"></script>

<script src="src/Leaflet.draw.js"></script>
<script src="src/Leaflet.Draw.Event.js"></script>

<script src="src/edit/handler/Edit.Poly.js"></script>
<script src="src/edit/handler/Edit.SimpleShape.js"></script>
<script src="src/edit/handler/Edit.Rectangle.js"></script>
<script src="src/edit/handler/Edit.Marker.js"></script>
<script src="src/edit/handler/Edit.CircleMarker.js"></script>
<script src="src/edit/handler/Edit.Circle.js"></script>

<script src="src/draw/handler/Draw.Feature.js"></script>
<script src="src/draw/handler/Draw.Polyline.js"></script>
<script src="src/draw/handler/Draw.Polygon.js"></script>
<script src="src/draw/handler/Draw.SimpleShape.js"></script>
<script src="src/draw/handler/Draw.Rectangle.js"></script>
<script src="src/draw/handler/Draw.Circle.js"></script>
<script src="src/draw/handler/Draw.Marker.js"></script>
<script src="src/draw/handler/Draw.CircleMarker.js"></script>

<script src="src/ext/TouchEvents.js"></script>
<script src="src/ext/LatLngUtil.js"></script>
<script src="src/ext/GeometryUtil.js"></script>
<script src="src/ext/LineUtil.Intersect.js"></script>
<script src="src/ext/Polyline.Intersect.js"></script>
<script src="src/ext/Polygon.Intersect.js"></script>

<script src="src/Control.Draw.js"></script>
<script src="src/Tooltip.js"></script>
<script src="src/Toolbar.js"></script>

<script src="src/draw/DrawToolbar.js"></script>
<script src="src/edit/EditToolbar.js"></script>
<script src="src/edit/handler/EditToolbar.Edit.js"></script>
<script src="src/edit/handler/EditToolbar.Delete.js"></script>
<link href='https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/leaflet.fullscreen.css' rel='stylesheet' />
<script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/Leaflet.fullscreen.min.js'></script>

<script src="https://unpkg.com/esri-leaflet"></script>

<!-- Esri Leaflet Geocoder -->
<link
  rel="stylesheet"
  href="https://unpkg.com/esri-leaflet-geocoder/dist/esri-leaflet-geocoder.css"
/>
<script src="https://unpkg.com/esri-leaflet-geocoder"></script>


	<link href="fix-wet-styles.css" rel="stylesheet" type="text/css">
	<link href="https://sms-sgs.ic.gc.ca/static/css/wizard.css" rel="stylesheet" type="text/css">
	<style>
		/* Styles for all mockups */
			.notesaboutmockup {
				color: #333;
				background: #FFD;
				padding: 0 1em;
				border-color: #FC6;
				border-width: 2px;
				border-style: solid;
				margin-top: 3em;
			}
			.notesaboutmockup h2 {
				font-size: inherit;
				margin-top: 1em;
			}
		/* Styles for this mockup */
			#superhead {
				font-size: 1.7em;
				font-weight: bold;
			}
			#status {
				border-left: 3px solid #999;
				padding-left: 2px;
				background-color: #EEE;
			}
			ul.nav-wizard li {
				font-size: inherit;
			}
			#map {
				border: 1px solid black;
				height: 20em;
			}
			#WKT {
				width: 100%;
			}
	</style>
<!-- End DECoE customization -->

	</head>
	<body vocab="http://schema.org/" typeof="WebPage">
		<div id="def-top">
			<!-- Write closure fall-back static file -->
			<!-- transactTop-en.html -->
		</div>
		<!-- Write closure template -->
		<script>
			var defTop = document.getElementById("def-top");
			defTop.outerHTML = wet.builder.top({
				"cdnEnv": "esdcprod",
				"lngLinks": [{
					"lang": "fr",
					"href": "transactional-fr.shtml",
					"text": "Fran√ßais"
				}],
				"search": false,
				"siteMenu": false,
				"breadcrumbs": [{
					"title": "SMS",
					"href": "index.html"
				},
				{
					"title": "NCLL portal",
					"href": "dashboard.html"
				}],
				"showPreContent": false
			});
		</script>
		<main property="mainContentOfPage" typeof="WebPageElement" class="container">

<!-- Start page content -->

	<div id="superhead">
		<p>Non-competitive local licence application (01000139-001) <span class="pull-right" id="status">Draft</span></p>
	</div>
	<div class="form-group">
		<ul class="nav nav-wizard">
			<li><a href="contact.html">Contact information</a></li>
			<li><a href="general.html">General information</a></li>
			<li class="active">Licence area</li>
			<li>Technical details</li>
			<li>Review</li>
		</ul>
	</div>

	<div class="wb-frmvld">
		<form action="tech-details.html" method="get">
			<div class="wb-frm">
				<div class="container">
					<h1 property="name" id="wb-cont">Licence area</h1>
					<p>Enter your licence area coordinates (maximum 12) by either</p>
					<ul>
						<li>using the draw tool on the interactive map</li>
						<li>entering them manually in a table</li>
						<li>entering your polygon formatted in WKT</li>
					</ul>
				
					<div class="row wb-eqht">
					<div class="col-md-4">
						<h2>Coordinates</h2>
						<p>Latitude and longitude coordinates are in degree decimal format.</p>
						<table class="table form-group">
							<tr>
								<th><span class="wb-inv">Number</span></th>
								<th>Latitude</th>
								<th>Longitude</th>
							</tr>
							<tr><td>1</td><td><input name="lat01" class="form-control" size=9 inputmode="decimal"></td><td><input name="long01" class="form-control" size=9 inputmode="decimal"></td></tr>
							<tr><td>2</td><td><input name="lat02" class="form-control" size=9 inputmode="decimal"></td><td><input name="long02" class="form-control" size=9 inputmode="decimal"></td></tr>
							<tr><td>3</td><td><input name="lat03" class="form-control" size=9 inputmode="decimal"></td><td><input name="long03" class="form-control" size=9 inputmode="decimal"></td></tr>
							<tr><td>4</td><td><input name="lat04" class="form-control" size=9 inputmode="decimal"></td><td><input name="long04" class="form-control" size=9 inputmode="decimal"></td></tr>
							<tr><td>5</td><td><input name="lat05" class="form-control" size=9 inputmode="decimal"></td><td><input name="long05" class="form-control" size=9 inputmode="decimal"></td></tr>
							<tr><td>6</td><td><input name="lat06" class="form-control" size=9 inputmode="decimal"></td><td><input name="long06" class="form-control" size=9 inputmode="decimal"></td></tr>
							<tr><td>7</td><td><input name="lat07" class="form-control" size=9 inputmode="decimal"></td><td><input name="long07" class="form-control" size=9 inputmode="decimal"></td></tr>
							<tr><td>8</td><td><input name="lat08" class="form-control" size=9 inputmode="decimal"></td><td><input name="long08" class="form-control" size=9 inputmode="decimal"></td></tr>
							<tr><td>9</td><td><input name="lat09" class="form-control" size=9 inputmode="decimal"></td><td><input name="long09" class="form-control" size=9 inputmode="decimal"></td></tr>
							<tr><td>10</td><td><input name="lat10" class="form-control" size=9 inputmode="decimal"></td><td><input name="long10" class="form-control" size=9 inputmode="decimal"></td></tr>
							<tr><td>11</td><td><input name="lat11" class="form-control" size=9 inputmode="decimal"></td><td><input name="long11" class="form-control" size=9 inputmode="decimal"></td></tr>
							<tr><td>12</td><td><input name="lat12" class="form-control" size=9 inputmode="decimal"></td><td><input name="long12" class="form-control" size=9 inputmode="decimal"></td></tr>
						</table>
					</div>
					<div class="col-md-8" id="map">
						<div style="display:flex; align-items:center; justify-content: center; height: 100%;width: 100%;">
							<div id="map" style="width: 1200px; height: 600px; border: 1px solid #ccc"></div>
							</div>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-md-12">
						<div class="form-group">
							<label for="WKT">
								<span class="field-name">
									Coordinates in <a href="https://en.wikipedia.org/wiki/Well-known_text_representation_of_geometry">Well Known Text</a> format
								</span>
							</label>
							<p>e.g. POLYGON((-113.956370 50.880852,-113.952550 50.880744,-113.944869 50.882288,-113.945942 50.884372,-113.951950 50.883398,-113.956885 50.882369,-113.956370 50.880852))</p>
							<input id="WKT" name="WKT" class="form-control">
						</div>

						<p>Once your area is entered, click <kbd><samp>Calculate</samp></kbd> to get the information about the area and to calculate the licence fee</p>
						<button type="button" class="btn btn-call-to-action" id="calculate-button">Calculate</button>

						<h2>Area information</h2>
						<div id="area-information-before">
							<p>Press <kbd><samp>Calculate</samp></kbd> to see results.</p>
						</div>
						<div id="area-information-after" hidden>
							<p><strong>Area size</strong> - <span class="area-size" id="area-size">162</span> km<sup>2</sup></p>
							<details>
								<summary>More information on area size</summary>
								<p>Total area covered by the licence</p>
							</details>

							<p><strong>Fee zone</strong> - <span class="fee-zone-type">Rural</span>: $<span class="fee-zone-cost">0.45</span> per MHz per year per km<sup>2</sup></p>
							<details>
								<summary>More information on fee zone</summary>
								<p>Licences in:</p>
								<ul class="list-unstyled">
									<li>Remote areas cost $0.01 per MHz per year per km<sup>2</sup></li>
									<li>Urban areas cost $1.80 per MHz per year per km<sup>2</sup></li>
									<li>Rural areas cost $0.45 per MHz per year per km<sup>2</sup></li>
								</ul>
							</details>

							<p><strong>Licence type</strong> - <span class="licence-type">Medium power (##</span> dBm/MHz)</p>
							<details>
								<summary>More information on licence type</summary>
								<ul class="list-unstyled">
									<li>Urban areas are low power (## dBm/MHz)</li>
									<li>Areas between 0&ndash;15 km<sup>2</sup> are low-power (## dBm/MHz)</li>
									<li>Areas between 75&ndash;165 km<sup>2</sup> are medium-power (## dBm/MHz)</li>
								</ul>
								<p>You can apply for multiple licences to cover an area larger than 15 km<sup>2</sup> with low power</p>
							</details>

							<p><strong>Placement of antenna</strong> - <span class="antenna">Indoor/outdoor</span></p>
							<details>
								<summary>More information on antenna location</summary>
								<ul class="list-unstyled">
									<li>Low power licences can be indoor/outdoor or indoor only</li>
									<li>Medium power licences can only be indoor/outdoor</li>
								</ul>
								<p>You can apply for multiple licences in order to cover an area larger than 15 km<sup>2</sup> that is indoor</p>
							</details>
						</div>

						<h2>Licence fee</h2>
						<div id="licence-fee-before">
							<p>Press <kbd><samp>Calculate</samp></kbd> to see results.</p>
						</div>
						<div id="licence-fee-after" hidden>
							<dl class="dl-horizontal">
								<dt>Base rate (Rural) per year</dt>
								<dd>$<span class="fee-zone-cost">0.45</span> per MHz per km<sup>2</sup></dd>
								<dt>Requested bandwidth</dt>
								<dd><span class="bandwidth">10</span> MHz</dd>
								<dt>Area size</dt>
								<dd><span class="area-size">162</span> km<sup>2</sup></dd>
							</dl>
							<dl class="dl-horizontal">
								<dt>Total cost per year</dt>
								<dd>$<span class="fee-zone-cost">0.45</span> &times; <span class="bandwidth">10</span> &times; <span class="area-size">162</span> = $<span class="total-cost">729.00</span></dd>
							</dl>
						</div>
					</div>
				</div>


				<button class="btn btn-primary" type="submit" id="next-button" hidden>Next</button>
				<button class="btn btn-secondary" type="button">Save</button>
				<br>
				<button class="btn btn-secondary" type="button">Back</button>

				<div class="notesaboutmockup">
					<h2>Notes about this mockup:</h2>
					<ul>
						<li>TODO: remove back button?</li>
						<li>TODO: make these numbers functional</li>
					</ul>
				</div>
			</div>
		</div>
	</form>
	<script>
		const calculateButton = document.getElementById ( "calculate-button" )
		const areaInformationBefore = document.getElementById ( "area-information-before" )
		const areaInformationAfter = document.getElementById ( "area-information-after" )
		const licenceFeeBefore = document.getElementById ( "licence-fee-before" )
		const licenceFeeAfter = document.getElementById ( "licence-fee-after" )
		const nextButton = document.getElementById ( "next-button" )
		calculateButton.addEventListener ( "click", (event) => {
			areaInformationBefore .setAttribute ( "hidden", "hidden" )
			areaInformationAfter .removeAttribute ( "hidden" )
			licenceFeeBefore .setAttribute ( "hidden", "hidden" )
			licenceFeeAfter .removeAttribute ( "hidden" )
			nextButton .removeAttribute ( "hidden" )
		})
	</script>
	</div>

<!-- End page content -->

			<div id="def-preFooter">
				<!-- Write closure fall-back static file -->
				<!-- preFooter-en.html -->
			</div>
			<!-- Write closure template -->
			<script>
				var defPreFooter = document.getElementById("def-preFooter");
				defPreFooter.outerHTML = wet.builder.preFooter({
					"cdnEnv": "esdcprod",
					"versionIdentifier": "CD56",
					"showPostContent": false,
					"showFeedback": false,
					"showShare": false
				});
			</script>
		</main>
		<div id="def-footer">
			<!-- Write closure fall-back static file -->
			<!-- transactFooter-en.html -->
		</div>
		<!-- Write closure template -->
		<script>
			var defFooter = document.getElementById("def-footer");
			defFooter.outerHTML = wet.builder.footer({
				"cdnEnv": "esdcprod",
				"showFooter": false,
				"showFeatures": false,
				"termsLink": [{
        			"newWindow": true
				}],
				"privacyLink": [{
					"newWindow": true
				}],
				"contextualFooter":{
					"title": "Spectrum and Telecommunications Sector",
					"links": [{
						"text": "Contact us",
						"href":"https://ised-isde.canada.ca/site/spectrum-management-telecommunications/en/licences-and-certificates/radiocom-information-circulars-ric/ric-66-addresses-and-telephone-numbers-district-offices",
						"newWindow": true
					}]
				}
			});
		</script>
		<!-- Write closure template -->
		<script>
			document.write(wet.builder.refFooter({
				"cdnEnv": "esdcprod"
			}));
		</script>
		<script>
            var osmUrl = 'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
                    osmAttrib = '&copy; <a href="http://openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                    osm = L.tileLayer(osmUrl, {maxZoom: 18, attribution: osmAttrib}),
                    map = new L.Map('map', {zoomControl:false, layers: [osm], center: new L.LatLng(57.27268094792591, -111.5815661012755), zoom: 10,selectedPathOptions: {
                color:'#ff9900'
                }});
        
            var drawnItems = new L.FeatureGroup();
            map.addLayer(drawnItems);
        
            new L.Control.Zoom({ position: 'bottomright' }).addTo(map);
        
            new L.Control.Fullscreen({position: 'topright'}).addTo(map);

			const baseLayers = {
				'Standard': osm,
				'Terrain': osm
			};

			const urban = L.layerGroup();
			const metro = L.layerGroup();
			const rural = L.layerGroup();
			const remote = L.layerGroup();
			const feezone = L.layerGroup();

			const overlays = {
				'Fee Zones': feezone,
			};

			const layerControl = L.control.layers(baseLayers, overlays, {position: 'topleft'});
        
            var drawControl = new L.Control.Draw({
                position: 'topleft',
                draw: {
                    polyline: false,
                    polygon: true,
                    circle: false,
                    rectangle: false,
                    marker: false,
                    circlemarker: false,
                polygon: {
                        allowIntersection: false,
                        showArea: true,
                        maxPoints:12,
                metric: "km",
                precision: {km:5},
                shapeOptions: {
                        fillColor :'#bf00ff',
                    fillOpacity:0.65,
                    color:"#8600b3",
                    opacity: 1
                          }
                }
        
                },
            });
        
			var searchControl = L.esri.Geocoding.geosearch({
				expanded: true,
        	})

			map.addControl(searchControl)
            map.addControl(drawControl);
			map.addControl(layerControl);

            var scale = L.control.scale(); // Creating scale control
                 scale.addTo(map); // Adding scale control to the map
        
        
        
            L.Control.RemoveAll = L.Control.extend({
                options: {
                    position: 'topleft',
                },
        
                onAdd: function (map) {
                    var controlDiv = L.DomUtil.create('div', 'leaflet-control leaflet-bar');
                    var controlUI = L.DomUtil.create('a', 'leaflet-draw-edit-remove', controlDiv);
                    controlUI.title = 'Remove all drawn items';
                    controlUI.setAttribute('href', '#');

                    controlUI.style.backgroundImage = 'url(src/images/trash.svg)'
        
                    L.DomEvent
                        .addListener(controlUI, 'click', L.DomEvent.stopPropagation)
                        .addListener(controlUI, 'click', L.DomEvent.preventDefault)
                        .addListener(controlUI, 'click', function () {
                            drawnItems.clearLayers();
                            map.removeControl(removeAllControl);
							map.removeControl(layerControl);
            				map.addControl(drawControl);
							map.addControl(layerControl);
                        });
                    return controlDiv;
                }
            });
        
        removeAllControl = new L.Control.RemoveAll();
        
        
        
        
        var getPopupContent = function(layer) {
        
                  // Rectangle/Polygon - area
                  var latlngs = layer._defaultShape ? layer._defaultShape() : layer.getLatLngs(),
                  area = L.GeometryUtil.geodesicArea(latlngs);
                  return "Area: "+ parseFloat(L.GeometryUtil.readableArea(area, true, 5).slice(0, -3))/100 + " square kilometer";
        
                };
        
        // TODO : on mouseout finish the polygon
        
        // on draw
            map.on(L.Draw.Event.CREATED, function (e) {
                var type = e.layerType,
                        layer = e.layer;
						
            map.removeControl(drawControl);
			map.removeControl(layerControl);
            map.addControl(removeAllControl);
			layerControl.addTo(map);
            layer.on('mouseover', function (event) {
                layer.bindPopup(getPopupContent(layer)).openPopup();
            });
            layer.on('mouseout', function (event) {
                layer.bindPopup(getPopupContent(layer)).closePopup();
            });
        
            
            
        
            layer.on(L.Draw.Event.EDITVERTEX, function(e){
                console.log(layer.getLatLngs()[0])
            })
        
            layer.editing.enable()
        
            drawnItems.addLayer(layer);
            
            drawnItems.setStyle({fillColor :'#33cc33',
                    fillOpacity:0.65,
                    color:"#248f24",
                    opacity: 1})

			
			span = document.getElementById("area-size");

			var latlngs = layer._defaultShape ? layer._defaultShape() : layer.getLatLngs(),
            area = L.GeometryUtil.geodesicArea(latlngs);
			span.innerText = span.textContent = parseFloat(L.GeometryUtil.readableArea(area, true, 5).slice(0, -3))/100;
            
            });
        
            map.on(L.Draw.Event.EDITVERTEX, function(e){
                console.log(e)
                console.log(e.layers.getLayers()[0])
            })
        
         
           map.on(L.Draw.Event.DELETED, function (e) {
        
            if (Object.keys(e.layers._layers).length != 0) {
                map.removeControl(removeAllControl);
				map.removeControl(layerControl);
                map.addControl(drawControl);
				layerControl.addTo(map);
            }
        
            
        });
        
        </script>
		<script>
			var defFooter = document.getElementById("def-footer");
			defFooter.outerHTML = wet.builder.footer({
				"cdnEnv": "esdcprod",
				"showFooter": false,
				"showFeatures": false,

				"contactLinks": [{
					"href": "#",
					"newWindow": true
				}],
				"termsLink": [{
					"href": "#"
				}],
				"privacyLink": [{
					"newWindow": true
				}]
			});
		</script>
		<!-- Write closure template -->
		<script>
			document.write(wet.builder.refFooter({
				"cdnEnv": "esdcprod"
			}));
		</script>
	</body>
</html>