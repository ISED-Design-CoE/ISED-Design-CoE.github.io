<!DOCTYPE html>
<html dir="ltr" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <meta name="description" content="Mockup." />

    <!-- TODO: Insert a concise, descriptive title that summarizes your page's content. -->
    <title>Broadcast certificate renewal</title>

    <!-- GC Design System -->
    <link
      rel="stylesheet"
      href="https://cdn.design-system.alpha.canada.ca/@cdssnc/gcds-components@0.37.0/dist/gcds/gcds.css"
    />
    <script
      type="module"
      src="https://cdn.design-system.alpha.canada.ca/@cdssnc/gcds-components@0.37.0/dist/gcds/gcds.esm.js"
    ></script>
    <link
      rel="stylesheet"
      href="https://cdn.design-system.alpha.canada.ca/@cdssnc/gcds-utility@1.9.0/dist/gcds-utility.min.css"
    />

    <style>
      /* Custom styles for spacing and layout */

      /* Adjust GCDS button styling for removal */
      .remove-email-button-container {
        margin-bottom: var(--gcds-spacing-400);
      }

      table > tbody > tr:nth-of-type(even) {
        background-color: var(--gcds-bg-light);
      }

      table > tbody > tr {
        border-top: solid var(--gcds-border-default) 1px;
        border-bottom: solid var(--gcds-border-default) 1px;
      }

      table > thead > tr > th {
        padding: var(--gcds-spacing-100);
      }

      table > tbody > tr > td {
        padding: var(--gcds-spacing-100);
      }
    </style>
  </head>

  <body>
    <!---------- Header ---------->
    <!-- TODO: Modify the lang-href to set the language toggle's URL. -->
    <!-- TODO: Update the skip-to-href with the main content container's id. -->
    <gcds-header lang-href="#" skip-to-href="#main-content">
      <!-- The slot="search" attribute adds the search component to the header. -->
      <gcds-search slot="search"></gcds-search>

      <!-- The slot="breadcrumb" attribute adds the breadcrumbs component to the header. -->
      <gcds-breadcrumbs hide-canada-link="true" slot="breadcrumb">
        <!-- TODO: Adjust the breadcrumb links with the correct ones for your site. -->
        <gcds-breadcrumbs-item href="index.html"
          >Broadcast certificate renewal form</gcds-breadcrumbs-item
        >
      </gcds-breadcrumbs>
    </gcds-header>

    <!---------- Main content ---------->
    <!-- TODO: Confirm the id matches the "skip-to-href" id in the header. -->
    <gcds-container
      id="main-content"
      main-container
      size="xl"
      centered
      tag="main"
    >
      <section>
        <gcds-heading tag="h1">Broadcast certificate renewal</gcds-heading>
        <!-- 
        <form id="record-form" method="post">
          <div
            style="
              background-color: var(--gcds-color-grayscale-50);
              padding: 20px;
            "
          >
            <gcds-text
              ><i>This section is for mockup purposes only</i></gcds-text
            >
            <gcds-heading tag="h2" margin-top="0">Record</gcds-heading>
            <gcds-select
              select-id="select-record"
              id="select-record"
              label="Select record to load"
              name="record"
              default-value="Select a record"
            >
              <option value="record-1">Broadcasting test</option>
              <option value="record-2">Broadcasting 123</option>
              <option value="record-3">Broadcasting stations</option>
            </gcds-select>

            <gcds-button type="submit">Load record</gcds-button>
          </div>
        </form> -->

        <div id="contact-info">
          <gcds-heading tag="h2">Contact information</gcds-heading>

          <!-- NOTE: dd, dl etc do not work with GC Design, it seems. -Jacob -->

          <gcds-text>
            <b>Company code</b><br /><span id="company_code"></span><br />
            <b>Business name</b><br /><span id="business_name"></span><br />
            <b>Address</b><br /><span id="address"></span><br />
            <b>Email</b><br /><span id="email[]"></span><br />
            <b>Phone number</b><br /><span id="business_phone"></span><br />
            <b>Language</b><br /><span id="language"></span><br />
          </gcds-text>

          <gcds-button
            button-role="secondary"
            onclick="window.location.href = 'edit-contact.html'"
          >
            Edit</gcds-button
          >

          <gcds-button
            id="validate-button"
            onclick="document.getElementById('main-form').removeAttribute('hidden'); document.getElementById('validate-button').style.display = 'none'; test()"
            >Validate</gcds-button
          >

          <script>
            sc6Rows = 0;
            function test() {
              [...document.getElementsByClassName("hide-legend")].forEach(
                (el) => {
                  console.log(el);
                  el.shadowRoot
                    .querySelector("fieldset")
                    .querySelector("legend")
                    .setAttribute("hidden", true);
                  el.addEventListener("gcdsInput", (event) => {
                    document
                      .getElementById("sc6andmore")
                      .setAttribute("hidden", true);
                    [
                      ...document.getElementsByClassName("first-button"),
                    ].forEach((el) => (el.style.display = "inline"));
                    if (event.detail == "yes") {
                      event.target.setAttribute("previous", "yes");
                      document
                        .getElementById(event.target.getAttribute("change"))
                        .removeAttribute("disabled");
                      document.getElementById("renewedLicences").innerHTML =
                        Number(
                          document.getElementById("renewedLicences").innerHTML
                        ) + 1;
                      sc6RowId = event.target.getAttribute("row-id");
                      if (sc6RowId != null) {
                        document
                          .getElementById(sc6RowId)
                          .removeAttribute("hidden");
                        if (sc6Rows == 0) {
                          document
                            .getElementById("sc6-table")
                            .removeAttribute("hidden");
                        }
                        sc6Rows += 1;
                      }
                    } else {
                      if (event.target.getAttribute("previous") == "yes") {
                        event.target.setAttribute("previous", "no");
                        document
                          .getElementById(event.target.getAttribute("change"))
                          .setAttribute("disabled", true);
                        document
                          .getElementById(event.target.getAttribute("change"))
                          .setAttribute("value", []);
                        document.getElementById("renewedLicences").innerHTML =
                          Number(
                            document.getElementById("renewedLicences").innerHTML
                          ) - 1;
                        sc6RowId = event.target.getAttribute("row-id");
                        if (sc6RowId != null) {
                          document
                            .getElementById(sc6RowId)
                            .setAttribute("hidden", true);
                          sc6Rows -= 1;
                          if (sc6Rows == 0) {
                            document
                              .getElementById("sc6-table")
                              .setAttribute("hidden", true);
                          }
                        }
                      }
                    }
                  });
                }
              );
            }
          </script>
        </div>
        <div id="main-form" hidden>
          <div style="height: var(--gcds-spacing-300)"></div>
          <gcds-notice
            type="success"
            notice-title-tag="h5"
            notice-title="Contact information validated"
          >
            <div style="height: var(--gcds-spacing-200)"></div>
          </gcds-notice>
          <form>
            <gcds-heading tag="h2" id="certificate-info"
              >Certificate information</gcds-heading
            >

            <gcds-button onclick="checkall()"> Renew all </gcds-button>

            <table
              id="cert"
              style="
                margin-top: var(--gcds-spacing-300);
                margin-bottom: var(--gcds-spacing-300);
                width: 110%;
              "
            >
              <script>
                fetch("tables/certificate-table.html")
                  .then((response) => response.text())
                  .then((html) => {
                    document.getElementById("cert").innerHTML = html;
                  });
              </script>
            </table>

            <div
              style="
                display: flex;
                align-items: center;
                gap: var(--gcds-spacing-100);
                margin-top: var(--gcds-spacing-100);
                margin-left: var(--gcds-spacing-200);
                margin-bottom: var(--gcds-spacing-200);
              "
            >
              <gcds-icon
                style="color: hsla(194, 67%, 35%, 1)"
                name="info-circle"
                size="h3"
              ></gcds-icon>
              <gcds-text margin-bottom="0" margin-top="0"
                >You're set to renew
                <b><span id="renewedLicences">0</span> out of 5</b>
                certificates.</gcds-text
              >
            </div>

            <div>
              <gcds-button
                class="first-button"
                onclick="document.getElementById('sc6andmore').removeAttribute('hidden');
                [...document.getElementsByClassName('first-button')].forEach(el => {
                  el.style.display = 'none';
                })"
                >Validate</gcds-button
              >
              <gcds-button
                class="first-button"
                button-role="secondary"
                onclick="document.getElementById('sc6andmore').removeAttribute('hidden')"
                >Save</gcds-button
              >
              <gcds-button
                class="first-button"
                button-role="secondary"
                onclick="document.getElementById('sc6andmore').removeAttribute('hidden')"
                >Clear form</gcds-button
              >
            </div>

            <div id="sc6andmore" hidden>
              <div id="sc6-table" hidden>
                <gcds-heading tag="h2">Safety code 6</gcds-heading>

                <gcds-text character-limit="false">
                  All main certificates that are not low power FM must comply
                  with
                  <gcds-link
                    target="_blank"
                    href="https://www.canada.ca/en/health-canada/services/health-risks-safety/radiation/occupational-exposure-regulations/safety-code-6-radiofrequency-exposure-guidelines.html"
                    >Safety Code 6</gcds-link
                  >.</gcds-text
                >

                <table id="sc6" style="width: 110%">
                  <script>
                    fetch("tables/sc6-table.html")
                      .then((response) => response.text())
                      .then((html) => {
                        document.getElementById("sc6").innerHTML = html;

                        var warning = {};

                        const container = document.getElementById("sc6-tbody");

                        const inputs = container.querySelectorAll("gcds-input");

                        inputs.forEach((input) => {
                          input.addEventListener("gcdsInput", (event) => {
                            if (input.getAttribute("name") == "sc6max[]") {
                              if (event.detail > 100) {
                                warning[input.getAttribute("id")] = true;
                                document.getElementById(
                                  "sc6-warning"
                                ).style.display = "flex";
                              } else {
                                warning[input.getAttribute("id")] = false;

                                // if all values are below 100, hide the warning
                                if (
                                  Object.values(warning).every(
                                    (value) => value === false
                                  )
                                ) {
                                  document.getElementById(
                                    "sc6-warning"
                                  ).style.display = "none";
                                }
                              }
                            }
                          });
                        });
                      });
                  </script>
                </table>

                <div style="height: var(--gcds-spacing-200)"></div>

                <div
                  id="sc6-warning"
                  style="
                    display: none;
                    align-items: center;
                    gap: var(--gcds-spacing-100);
                    margin-top: var(--gcds-spacing-100);
                    margin-left: var(--gcds-spacing-200);
                    margin-bottom: var(--gcds-spacing-200);
                  "
                >
                  <gcds-notice
                    type="danger"
                    notice-title-tag="h5"
                    notice-title="Max level beyond 100."
                  >
                    <gcds-text
                      >It appears that one or more of these sites might not
                      conform to Safety Code 6. Please contact our nearest
                      district office.</gcds-text
                    >
                  </gcds-notice>
                </div>
              </div>

              <div>
                <gcds-button
                  type="submit"
                  button-role="start"
                  onClick="window.location.href = 'review.html'"
                  >Continue to review</gcds-button
                >
                <gcds-button
                  button-role="secondary"
                  onclick="document.getElementById('sc6andmore').removeAttribute('hidden')"
                  >Save</gcds-button
                >
                <gcds-button
                  button-role="secondary"
                  onclick="document.getElementById('sc6andmore').removeAttribute('hidden')"
                  >Clear form</gcds-button
                >
              </div>
            </div>
          </form>
        </div>
      </section>

      <!-- TODO: Update the date to reflect the page's most recent change. -->
      <gcds-date-modified>2025-10-01</gcds-date-modified>
    </gcds-container>

    <!---------- Footer ---------->
    <!-- TODO: Update or remove the contextual footer heading and links as needed. -->
    <gcds-footer
      display="full"
      contextual-heading="Innovation, Science and Economic Development"
      contextual-links='{ "Contact us": "#"}'
    >
    </gcds-footer>

    <script src="scripts/populate-inputs.js"></script>

    <script>
      populate_input("record-1");
      document.addEventListener("DOMContentLoaded", () => {
        let params = new URLSearchParams(document.location.search);
        if (params.get("record") != null) {
          populate_input(params.get("record"));
          document.getElementById("main-form").removeAttribute("hidden");
          document.getElementById("certificate-info").scrollIntoView();
          document.getElementById("validate-button").style.display = "none";
        }
      });
    </script>
    <script type="text/javascript" src="scripts/toggle-table.js"></script>
  </body>
</html>
